"use strict";(self.webpackChunkapp_web=self.webpackChunkapp_web||[]).push([[260],{2569:(e,t,a)=>{a.r(t),a.d(t,{addLabel:()=>s,deleteImgByName:()=>c,deleteLabelById:()=>d,editProduct:()=>r,getLabelList:()=>l,getProductById:()=>o,uploadProductBanner:()=>i});var n=a(167);const l=e=>n.aA.request({method:"get",url:"/label",data:e}),d=e=>n.aA.request({method:"delete",url:"/label/".concat(e)}),o=e=>n.aA.request({method:"get",url:"/label/".concat(e)}),s=e=>n.aA.request({method:"post",url:"/label/",data:e}),r=e=>n.aA.request({method:"put",url:"/label/update",data:e}),i=e=>n.m7.request({method:"post",url:"/upload/product_banner",data:e}),c=e=>n.aA.request({method:"post",url:"/upload/deleteStaticImg",data:e})},775:(e,t,a)=>{a.r(t),a.d(t,{addProduct:()=>o,deleteImgByName:()=>c,deleteProductById:()=>i,editProduct:()=>s,getProductById:()=>d,getProductList:()=>l,uploadProductBanner:()=>r});var n=a(167);const l=e=>n.aA.request({method:"post",url:"/product/list",data:e}),d=e=>n.aA.request({method:"get",url:"/product/list/".concat(e)}),o=e=>n.aA.request({method:"post",url:"/product/create",data:e}),s=e=>n.aA.request({method:"put",url:"/product/update",data:e}),r=e=>n.m7.request({method:"post",url:"/upload/product_banner",data:e}),i=e=>n.aA.request({method:"delete",url:"/product/delete/".concat(e)}),c=e=>n.aA.request({method:"post",url:"/upload/deleteStaticImg",data:e})},3262:(e,t,a)=>{function n(){let{extraHeight:e,id:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"undefined"==typeof e&&(e=74);let a=null;a=t?document.getElementById(t)?document.getElementById(t).getElementsByClassName("ant-table-thead")[0]:null:document.getElementsByClassName("ant-table-thead")[0];let n=0;return a&&(n=a.getBoundingClientRect().bottom),"calc(100vh - ".concat(n+e,"px)")}a.d(t,{W:()=>n})},9260:(e,t,a)=>{a.r(t),a.d(t,{default:()=>q});var n,l=a(2791),d=a(168),o=a(3517);const s=o.ZP.div(n||(n=(0,d.Z)(["\n  height: 100%;\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  box-sizing: border-box;\n  overflow: hidden;\n  .basic {\n    padding: 16px;\n    background-color: #fff;\n    border-radius: 8px;\n  }\n  .query {\n    margin-bottom: 10px;\n  }\n  .table {\n    flex: 1;\n    overflow: hidden;\n    .actions {\n      margin-bottom: 15px;\n    }\n  }\n"])));var r=a(2641),i=a(2495),c=(a(7892),a(8531)),u=a(1773),m=a(1082),p=a(184);const h=function(){let{handleDelete:e=(()=>{}),handleEdit:t=(()=>{})}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{title:"\u6807\u7b7e\u540d",dataIndex:"name",align:"center",key:"name"},{title:"\u6807\u7b7eicon",dataIndex:"icon",align:"center",key:"icon",render:e=>(0,p.jsx)(c.Z,{width:70,height:50,src:e})},{title:"\u64cd\u4f5c",key:"action",render:(a,n)=>(0,p.jsxs)(u.Z,{size:"small",children:[(0,p.jsx)(r.ZP,{type:"link",onClick:()=>t(n),children:"\u7f16\u8f91"}),(0,p.jsx)(m.Z,{title:"\u5220\u9664",description:"\u6b64\u64cd\u4f5c\u5c06\u4f1a\u6c38\u4e45\u5220\u9664",onConfirm:t=>(t=>{e(t)})(n),okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:(0,p.jsx)(r.ZP,{type:"link",children:"\u5220\u9664"})})]})}]};var g,x=a(8526),b=a(8138),f=a(8737);const y=o.ZP.div(g||(g=(0,d.Z)([""])));var v=a(9286),j=a(1994);a(775);const w=e=>{const{setPath:t,onChange:a,imgList:n,maxCount:d}=e,[o,s]=(0,l.useState)(!1),[r,i]=(0,l.useState)(""),[c,u]=(0,l.useState)(""),[m,h]=(0,l.useState)([]);(0,l.useEffect)((()=>{n&&h(n)}),[n]);const g=(0,p.jsxs)("div",{children:[(0,p.jsx)(v.Z,{}),(0,p.jsx)("div",{style:{marginTop:8},children:"Upload"})]});return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(j.Z,{listType:"picture-card",fileList:m,onPreview:async e=>{e.url||e.preview||(e.preview=await(e=>new Promise(((t,a)=>{const n=new FileReader;n.readAsDataURL(e),n.onload=()=>t(n.result),n.onerror=e=>a(e)})))(e.originFileObj)),i(e.url||e.preview),s(!0),u(e.name||e.url.substring(e.url.lastIndexOf("/")+1))},onChange:e=>{let{file:n,fileList:l}=e;console.log(l,"change"),t(l),a(l),h(l)},onRemove:async e=>{},beforeUpload:()=>!1,maxCount:d||null,children:m.length>=8?null:g}),(0,p.jsx)(b.Z,{open:o,title:c,footer:null,onCancel:()=>s(!1),children:(0,p.jsx)("img",{alt:"example",style:{width:"100%"},src:r})})]})};var C=a(2569);const P=(0,l.memo)((e=>{const{title:t,type:a,editId:n,dialogClose:d,dialogConfrim:o}=e,[s]=x.Z.useForm(),[r,i]=(0,l.useState)([]),[c,u]=(0,l.useState)([]),m=async e=>{const t=new FormData;e.forEach((e=>{t.append("img",e.originFileObj)}));const{data:a}=await C.uploadProductBanner(t);return a};return(0,l.useEffect)((()=>{(async()=>{if("edit"===a&&n){const{code:a,data:l}=await C.getProductById(n);var e;0===a&&(s.setFieldsValue({...l}),u((t=null===l||void 0===l||null===(e=l.icon)||void 0===e?void 0:e.split(","))?t.map((e=>({url:e}))):[]))}var t})()}),[]),(0,p.jsx)(y,{children:(0,p.jsx)(b.Z,{title:t,open:!0,onCancel:d,onOk:()=>s.submit(),children:(0,p.jsxs)(x.Z,{autoComplete:"off",form:s,labelCol:{span:6},onFinish:async e=>{if("add"===a){console.log(e);const t=await m(r),a={...e,icon:t.join(",")};o(a,"add")}else{let t=await(async(e,t)=>{let a=[];if(e.length){let t=e.filter((e=>!e.url)),n=e.filter((e=>e.url));t.length&&(a=(await m(t)).map((e=>({url:e})))),a=[...a,...n]}else a=t;return a.map((e=>e.url))})(r,c);const a={...e,id:n,icon:t.join(",")};o(a,"edit")}},children:[(0,p.jsx)(x.Z.Item,{label:"\u6807\u7b7e\u540d\u79f0",name:"name",validateTrigger:"onBlur",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u5fc5\u586b\u9879"}],children:(0,p.jsx)(f.Z,{placeholder:"\u8bf7\u8f93\u5165"})}),(0,p.jsx)(x.Z.Item,{rules:[{required:!0,message:"\u5fc5\u586b\u9879"}],label:"\u6807\u7b7eicon",name:"icon",children:(0,p.jsx)(w,{setPath:i,imgList:c,maxCount:1})})]})})})}));P.defaultProps={title:"\u65b0\u589e"};const Z=P;var I=a(3262);const q=(0,l.memo)((()=>{const[e,t]=(0,l.useState)([]),[a,n]=(0,l.useState)(!1),[d,o]=(0,l.useState)(!1),[c,u]=(0,l.useState)("add"),[m,g]=(0,l.useState)(0),[x,b]=(0,l.useState)(0),f=async()=>{try{o(!0);const{data:e}=await C.getLabelList();o(!1);const a=e.map((e=>(e.key=e.id,e)));t(a)}catch(e){console.log(e)}};(0,l.useEffect)((()=>{f();const e=(0,I.W)();b(e)}),[]);const y=(0,l.useCallback)((async(e,t)=>{console.log(e);const a="add"===t?"addLabel":"editProduct",{code:l}=await C[a](e);0===l&&(window.$msg.success("\u6dfb\u52a0\u6210\u529f\uff5e"),f(),n(!1))}),[]);return(0,p.jsxs)(s,{children:[(0,p.jsxs)("div",{className:"table basic",children:[(0,p.jsx)("div",{className:"actions",children:(0,p.jsx)(r.ZP,{type:"primary",onClick:()=>{u("add"),n(!0)},children:"\u65b0\u589e"})}),(0,p.jsx)(i.Z,{bordered:!0,columns:h({handleDelete:async e=>{let{id:t}=e;const{code:a}=await C.deleteLabelById(t);0===a&&(window.$msg.success("\u64cd\u4f5c\u6210\u529f\uff5e"),f())},handleEdit:e=>{let{id:t}=e;g(t),u("edit"),n(!0)}}),dataSource:e,pagination:!1,loading:d,scroll:{y:x}})]}),a&&(0,p.jsx)(Z,{dialogClose:e=>{n(!1)},dialogConfrim:y,type:c,editId:m})]})}))}}]);
//# sourceMappingURL=260.a7eb7fe2.chunk.js.map